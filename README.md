---
title:  aws-iot-dragonconnect-c
---
# aws-iot-dragonconnect-c

# Introduction
The DragonConnect project demonstrates recording events originating from
the DragonBoard and managing an LED.  The events are generated by pressing
the volume up and volume down keys on the DragonBoard.  When one of the
buttons is pressed, a client application written using the Amazon IoT C SDK
for embedded platforms uses MQTT to transfer the event to an Amazon data
center where it is stored in a DynamoDB table.

The LED is managed through the General Purpose IO (GPIO) of the DragonBoard
and uses AWS IoT Device Shadows.  The LED is controlled using the same
application that recorded the volume events.

# Getting Started
In order to run this demonstrations, you will need

* An Amazon account
* A breadboard
* Wire
* LED
* 50 m&#x2126; resisitor

## Completing the Circuit

**NOTE:** Please ensure that your DragonBoard is powered off and the power
supply has been disconnected from the DragonBoard.  This is a good practice
that will help reduce the chances of an accidental short circuit that could
damage your single board computer.

Follow the steps below to complete the circuit

* Connect one end of the wire from the GPIO 12 (positive) position to a row (m) in the breadboard
* Connect one end of the resistor in the same row as the wire from GPIO 12 (m)
* Connect the other end of the resistor to to a different row (n)
* Connect the anode of the LED in the same row (n)
* Connect the cathode of the LED to a different row (o)
* Connect the ground from the GPIO (pin 2) to the row with the LED cathode (o)

Your circuit should look similar to the following

![DragonBoard Manage LED Breadboard](docs/ManageLED_breadboard.png)

## Configure the AWS IoT Services

Configuring the AWS IoT services is done by

* Create a principal for the 'thing'.  In this case, the DragonBoard.

    ```sh
    $ aws iot create-keys-and-certificate --set-as-active > keysAndCertificates
    ```

    The resultant file has the public and private keys for a thing in the following format

    ```json
    {
      "certificateArn": "arn:aws:iot:...",
      "certificatePem": "...",
      "keyPair": {
        "PublicKey": "...",
        "PrivateKey": "..."
      },
      "certificateId": "..."
    }
    ```

    The public and private key have embedded newline characters.  In order to remove the newline characters use the following command

    ```sh
    $ printf -- "-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----\n" > thing.pub
    $ printf -- "-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----\n" > thing.key
    ```

* Create a thing in the AWS IoT device registry.

    ```sh
    $ aws iot create-thing --thing-name dragonconnect
    ```

    The output of the command is

    ```json
    {
      "thingArn": "arn:aws:iot:region:012345678901:thing/dragonconnect", 
      "thingName": "dragonconnect"
    }
    ```

* Attach a principal to the thing.

    ```sh
    $ aws iot attach-thing-principal --thing-name dragonconnect --principal arn:aws:iot:region:012345678901:cert/e293dcaefc36d85d54cccce9a77e79d0f18ae49d1b154814d436dd89f55c5f33
    ```

* Creating a policy that enables the thing to use the appropriate topics.

    ```sh
    $ aws iot create-policy --policy-name dragonconnect --policy-document file://policies/dragonconnect.json
    ```

    The output of the command will be similar to

    ```json
    {
      "policyName": "dragonconnect",
      "policyArn": "arn:aws:iot:region:012345678901:policy/dragonconnect",
      "policyDocument": "...",
      "policyVersionId": "1"
    }
    ```

* Attach the policy to the principal.

    ```sh
    $ aws iot attach-principal-policy --policy-name dragonconnect --principal arn:aws:iot:region:012345678901:cert/e293dcaefc36d85d54cccce9a77e79d0f18ae49d1b154814d436dd89f55c5f33
    ```
